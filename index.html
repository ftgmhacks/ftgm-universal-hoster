<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTGM DIRECT HOSTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #050508;
            --primary: #9d50bb;
            --secondary: #6e48aa;
            --accent: #00f2fe;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: white;
            font-family: 'Plus Jakarta Sans', sans-serif;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }

        .main-card {
            width: 90%; max-width: 600px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 40px; text-align: center;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
        }

        h1 { font-weight: 800; font-size: 2.2rem; margin-bottom: 5px; }
        .feature-icons { display: flex; justify-content: center; gap: 20px; margin: 20px 0; color: var(--primary); font-size: 1.2rem; }

        /* Modern Upload Animation Area */
        .drop-zone {
            border: 2px dashed var(--secondary);
            border-radius: 20px;
            padding: 50px 20px;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
        }

        .drop-zone.loading {
            border-color: var(--accent);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.98); opacity: 0.7; border-color: var(--primary); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Buttons */
        .btn-host {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none; padding: 15px 30px; border-radius: 12px;
            color: white; font-weight: 700; width: 100%; margin-top: 25px;
            cursor: pointer; font-size: 1rem; transition: 0.3s;
        }

        .output-section {
            display: none; margin-top: 30px;
            background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px;
            border: 1px solid var(--accent);
        }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action {
            flex: 1; padding: 12px; border-radius: 8px; border: none;
            cursor: pointer; font-weight: 600; font-size: 0.9rem;
        }
        .btn-copy { background: var(--accent); color: #000; }
        .btn-visit { background: white; color: #000; }

        #filePreview {
            margin-top: 15px; font-size: 0.9rem; color: var(--accent);
            display: none; font-weight: 600;
        }
    </style>
</head>
<body>

<div class="main-card">
    <h1>FTGM FILES HOSTER</h1>
    <div class="feature-icons">
        <i class="fa-solid fa-video"></i>
        <i class="fa-solid fa-music"></i>
        <i class="fa-solid fa-image"></i>
        <i class="fa-solid fa-file-pdf"></i>
    </div>

    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 2.5rem; margin-bottom: 10px;"></i>
        <p id="dropText">Select Image, Video, Audio or PDF</p>
        <div id="filePreview"></div>
    </div>

    <input type="file" id="fileInput" hidden accept="image/*,video/*,audio/*,application/pdf">

    <button class="btn-host" id="hostBtn">HOST & GENERATE LINK</button>

    <div class="output-section" id="output">
        <p style="margin:0; color: var(--accent);">âœ” File Successfully Hosted!</p>
        <div class="btn-group">
            <button class="btn-action btn-copy" onclick="copyCode()"><i class="fa-solid fa-code"></i> Copy Code</button>
            <button class="btn-action btn-visit" onclick="visitNow()"><i class="fa-solid fa-external-link"></i> Visit Now</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

    const config = { databaseURL: "https://ftgm-host-default-rtdb.firebaseio.com" };
    const app = initializeApp(config);
    const db = getDatabase(app);

    const fileInput = document.getElementById('fileInput');
    const hostBtn = document.getElementById('hostBtn');
    const dropZone = document.getElementById('dropZone');
    const preview = document.getElementById('filePreview');
    const output = document.getElementById('output');

    let generatedUrl = "";
    let fileType = "";

    // --- CHECK FOR REDIRECT (DIRECT VIEW) ---
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');

    if (id) {
        document.body.innerHTML = "<div style='color:white; text-align:center; padding:50px;'>Loading Direct File...</div>";
        get(child(ref(db), `files/${id}`)).then((snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                const byteString = atob(data.base64.split(',')[1]);
                const mimeString = data.base64.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
                const blob = new Blob([ab], {type: mimeString});
                const blobUrl = URL.createObjectURL(blob);
                window.location.replace(blobUrl); // Redirects to the raw file full screen
            }
        });
    }

    // --- UI LOGIC ---
    fileInput.onchange = () => {
        if(fileInput.files[0]) {
            preview.innerText = "Selected: " + fileInput.files[0].name;
            preview.style.display = "block";
            document.getElementById('dropText').style.display = "none";
        }
    };

    hostBtn.onclick = async () => {
        const file = fileInput.files[0];
        if (!file) return alert("Select a file first!");
        
        // Allowed Types Check
        const allowed = ['image/', 'video/', 'audio/', 'application/pdf'];
        if (!allowed.some(type => file.type.startsWith(type))) {
            return alert("Only Images, Videos, Audio, and PDFs are allowed!");
        }

        dropZone.classList.add('loading');
        hostBtn.innerText = "UPLOADING TO FTGM SERVER...";
        hostBtn.disabled = true;

        const reader = new FileReader();
        reader.onload = async (e) => {
            const uniqueId = Math.random().toString(36).substring(2, 9);
            fileType = file.type;
            
            await set(ref(db, 'files/' + uniqueId), {
                base64: e.target.result,
                name: file.name,
                type: file.type
            });

            generatedUrl = `https://ftgm-universal-hoster.vercel.app/?id=${uniqueId}`;
            dropZone.classList.remove('loading');
            hostBtn.style.display = "none";
            output.style.display = "block";
        };
        reader.readAsDataURL(file);
    };

    window.visitNow = () => window.open(generatedUrl, '_blank');

    window.copyCode = () => {
        let code = "";
        if(fileType.includes('image')) code = `<img src="${generatedUrl}" alt="FTGM File">`;
        else if(fileType.includes('video')) code = `<video src="${generatedUrl}" controls></video>`;
        else if(fileType.includes('audio')) code = `<audio src="${generatedUrl}" controls></audio>`;
        else code = `<a href="${generatedUrl}">View PDF</a>`;
        
        navigator.clipboard.writeText(code);
        alert("HTML Code Copied! You can now use this on your website.");
    };
</script>

</body>
</html>
